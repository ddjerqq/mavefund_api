<!DOCTYPE html>
<html>
<script src="./Chart.js"></script>

<head>
  <meta charset="utf-8">
  <title>Home</title>
  <link rel="stylesheet" type="text/css" href="index.css">
</head>

<body>
  <div class="header">
    <h4 id="user_data">User: bozidark35</h4>
    <h4 id="signout" onclick="signout()">Sign out</h4>
  </div>
  <button class="button-43" role="button" onclick='document.getElementById("myChart").style.display = "block"'>Show Chart</button>

  <canvas id="myChart" style="width:100%;max-width:600px"></canvas>

  <script>
    document.getElementById("myChart").style.display = "none"
    var xValues = [50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150];
    var yValues = [7, 8, 8, 9, 9, 9, 10, 11, 14, 14, 15];

    new Chart("myChart", {
      type: "line",
      data: {
        labels: xValues,
        datasets: [{
          fill: false,
          lineTension: 0,
          backgroundColor: "rgba(0,0,255,1.0)",
          borderColor: "rgba(0,0,255,0.1)",
          data: yValues
        }]
      },
      options: {
        legend: { display: false },
        scales: {
          yAxes: [{ ticks: { min: 6, max: 16 } }],
        }
      }
    });

    function parseJwt(token) {
      var base64Url = token.split('.')[1];
      var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));

      return JSON.parse(jsonPayload);
    }

    function getStoredValue(key) {
      if (localStorage) {
        return localStorage.getItem(key);
      } else {
        return $.cookies.get(key);
      }
    }

    function removeStoredValue(key) {
      if (localStorage) {
        return localStorage.removeItem(key);
      } else {
        return $.cookies.remove(key);
      }
    }


    try {
      const jwt_expire = parseJwt(getStoredValue("token"))
      const dateObject = new Date(jwt_expire.exp * 1000)
      if (dateObject <= new Date()) {
        removeStoredValue("token")
        window.location.replace("login.html");
      }
    }
    catch {
      window.location.replace("login.html");
    }

    function signout() {
      removeStoredValue("token")
      window.location.replace("login.html");
    }

    document.getElementById("user_data").innerHTML = "User: " + getStoredValue("username")


  </script>

</body>


</html>